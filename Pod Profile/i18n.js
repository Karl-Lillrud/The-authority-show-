// i18n.js

const translations = {
    en: {
        "title": {
            "podProfile": "Pod Profile"
        },
        "headings": {
            "podProfile": "Pod Profile",
            "socialMedia": "Podcast Social Media",
            "team": "Team"
        },
        "labels": {
            "podName": "Pod Name",
            "podRss": "Pod RSS",
            "podLogo": "Pod Logo",
            "hostName": "Host Name",
            "googleCalendar": "Google Calendar Integration",
            "calendarUrl": "Google Calendar Pick a Date URL",
            "guestForm": "Guest Form URL",
            "facebook": "Facebook",
            "instagram": "Instagram",
            "linkedin": "LinkedIn",
            "twitter": "Twitter",
            "tiktok": "TikTok",
            "pinterest": "Pinterest",
            "website": "Podcast Website",
            "email": "Podcast Email Address",
            "teamName": "Name",
            "teamEmail": "Email",
            "teamRole": "Role"
        },
        "buttons": {
            "copy": "Copy",
            "invite": "Invite",
            "block": "Block",
            "submit": "Submit"
        },
        "options": {
            "selectRole": "Select Role",
            "user": "User",
            "host": "Host"
        },
        "errors": {
            "podName": "Please enter the pod name.",
            "podRss": "Please enter a valid RSS URL.",
            "hostName": "Please enter the host name.",
            "calendarUrl": "Please enter a valid Calendar URL.",
            "guestForm": "Please enter a valid Guest Form URL.",
            "email": "Please enter a valid email address.",
            "facebook": "Please enter a valid Facebook URL.",
            "instagram": "Please enter a valid Instagram URL.",
            "linkedin": "Please enter a valid LinkedIn URL.",
            "twitter": "Please enter a valid Twitter URL.",
            "tiktok": "Please enter a valid TikTok URL.",
            "pinterest": "Please enter a valid Pinterest URL.",
            "website": "Please enter a valid website URL.",
            "teamName": "Please enter the team member's name.",
            "teamEmail": "Please enter a valid email address.",
            "teamRole": "Please select a role."
        },
        "notifications": {
            "defaultToast": "This is a toast message.",
            "guestFormCopied": "Guest Form URL copied to clipboard!",
            "copyFailed": "Failed to copy URL.",
            "calendarActivated": "Google Calendar Integration Activated!",
            "calendarDeactivated": "Google Calendar Integration Deactivated!",
            "fillAllFields": "Please fill in all team member details.",
            "fillAllTeamFields": "Please fill in all team member fields.",
            "invitationSent": "Invitation sent to",
            "invitationFailed": "Failed to send invitation.",
            "blocked": "Team member with email",
            "blockFailed": "Failed to block team member.",
            "submitting": "Submitting Pod Profile...",
            "submissionSuccess": "Pod Profile submitted successfully!",
            "submissionFailed": "Failed to submit Pod Profile.",
            "correctErrors": "Please correct the errors in the form."
        }
    },
    es: {
        "title": {
            "podProfile": "Perfil del Pod"
        },
        "headings": {
            "podProfile": "Perfil del Pod",
            "socialMedia": "Redes Sociales del Podcast",
            "team": "Equipo"
        },
        "labels": {
            "podName": "Nombre del Pod",
            "podRss": "RSS del Pod",
            "podLogo": "Logo del Pod",
            "hostName": "Nombre del Anfitrión",
            "googleCalendar": "Integración con Google Calendar",
            "calendarUrl": "URL para Elegir Fecha en Google Calendar",
            "guestForm": "URL del Formulario de Invitados",
            "facebook": "Facebook",
            "instagram": "Instagram",
            "linkedin": "LinkedIn",
            "twitter": "Twitter",
            "tiktok": "TikTok",
            "pinterest": "Pinterest",
            "website": "Sitio Web del Podcast",
            "email": "Correo Electrónico del Podcast",
            "teamName": "Nombre",
            "teamEmail": "Correo Electrónico",
            "teamRole": "Rol"
        },
        "buttons": {
            "copy": "Copiar",
            "invite": "Invitar",
            "block": "Bloquear",
            "submit": "Enviar"
        },
        "options": {
            "selectRole": "Seleccionar Rol",
            "user": "Usuario",
            "host": "Anfitrión"
        },
        "errors": {
            "podName": "Por favor, ingrese el nombre del pod.",
            "podRss": "Por favor, ingrese una URL de RSS válida.",
            "hostName": "Por favor, ingrese el nombre del anfitrión.",
            "calendarUrl": "Por favor, ingrese una URL de Calendario válida.",
            "guestForm": "Por favor, ingrese una URL del Formulario de Invitados válida.",
            "email": "Por favor, ingrese una dirección de correo electrónico válida.",
            "facebook": "Por favor, ingrese una URL de Facebook válida.",
            "instagram": "Por favor, ingrese una URL de Instagram válida.",
            "linkedin": "Por favor, ingrese una URL de LinkedIn válida.",
            "twitter": "Por favor, ingrese una URL de Twitter válida.",
            "tiktok": "Por favor, ingrese una URL de TikTok válida.",
            "pinterest": "Por favor, ingrese una URL de Pinterest válida.",
            "website": "Por favor, ingrese una URL de sitio web válida.",
            "teamName": "Por favor, ingrese el nombre del miembro del equipo.",
            "teamEmail": "Por favor, ingrese una dirección de correo electrónico válida.",
            "teamRole": "Por favor, seleccione un rol."
        },
        "notifications": {
            "defaultToast": "Este es un mensaje de notificación.",
            "guestFormCopied": "¡URL del Formulario de Invitados copiada al portapapeles!",
            "copyFailed": "Error al copiar la URL.",
            "calendarActivated": "¡Integración con Google Calendar Activada!",
            "calendarDeactivated": "¡Integración con Google Calendar Desactivada!",
            "fillAllFields": "Por favor, complete todos los detalles del miembro del equipo.",
            "fillAllTeamFields": "Por favor, complete todos los campos del miembro del equipo.",
            "invitationSent": "Invitación enviada a",
            "invitationFailed": "Error al enviar la invitación.",
            "blocked": "Miembro del equipo con correo electrónico",
            "blockFailed": "Error al bloquear al miembro del equipo.",
            "submitting": "Enviando Perfil del Pod...",
            "submissionSuccess": "¡Perfil del Pod enviado con éxito!",
            "submissionFailed": "Error al enviar el Perfil del Pod.",
            "correctErrors": "Por favor, corrija los errores en el formulario."
        }
    },
    ar: {
        "title": {
            "podProfile": "ملف البود"
        },
        "headings": {
            "podProfile": "ملف البود",
            "socialMedia": "وسائل التواصل الاجتماعي للبودكاست",
            "team": "الفريق"
        },
        "labels": {
            "podName": "اسم البود",
            "podRss": "RSS للبود",
            "podLogo": "شعار البود",
            "hostName": "اسم المضيف",
            "googleCalendar": "تكامل تقويم Google",
            "calendarUrl": "رابط اختيار تاريخ تقويم Google",
            "guestForm": "رابط نموذج الضيف",
            "facebook": "فيسبوك",
            "instagram": "إنستغرام",
            "linkedin": "لينكدإن",
            "twitter": "تويتر",
            "tiktok": "تيك توك",
            "pinterest": "بينترست",
            "website": "موقع البودكاست",
            "email": "عنوان البريد الإلكتروني للبودكاست",
            "teamName": "الاسم",
            "teamEmail": "البريد الإلكتروني",
            "teamRole": "الدور"
        },
        "buttons": {
            "copy": "نسخ",
            "invite": "دعوة",
            "block": "حظر",
            "submit": "إرسال"
        },
        "options": {
            "selectRole": "اختر الدور",
            "user": "مستخدم",
            "host": "مضيف"
        },
        "errors": {
            "podName": "يرجى إدخال اسم البود.",
            "podRss": "يرجى إدخال رابط RSS صالح.",
            "hostName": "يرجى إدخال اسم المضيف.",
            "calendarUrl": "يرجى إدخال رابط تقويم صالح.",
            "guestForm": "يرجى إدخال رابط نموذج ضيف صالح.",
            "email": "يرجى إدخال عنوان بريد إلكتروني صالح.",
            "facebook": "يرجى إدخال رابط فيسبوك صالح.",
            "instagram": "يرجى إدخال رابط إنستغرام صالح.",
            "linkedin": "يرجى إدخال رابط لينكدإن صالح.",
            "twitter": "يرجى إدخال رابط تويتر صالح.",
            "tiktok": "يرجى إدخال رابط تيك توك صالح.",
            "pinterest": "يرجى إدخال رابط بينترست صالح.",
            "website": "يرجى إدخال رابط موقع ويب صالح.",
            "teamName": "يرجى إدخال اسم عضو الفريق.",
            "teamEmail": "يرجى إدخال عنوان بريد إلكتروني صالح.",
            "teamRole": "يرجى اختيار دور."
        },
        "notifications": {
            "defaultToast": "هذه رسالة توست.",
            "guestFormCopied": "تم نسخ رابط نموذج الضيف إلى الحافظة!",
            "copyFailed": "فشل في نسخ الرابط.",
            "calendarActivated": "تم تفعيل تكامل تقويم Google!",
            "calendarDeactivated": "تم إلغاء تفعيل تكامل تقويم Google!",
            "fillAllFields": "يرجى ملء جميع تفاصيل عضو الفريق.",
            "fillAllTeamFields": "يرجى ملء جميع حقول عضو الفريق.",
            "invitationSent": "تم إرسال الدعوة إلى",
            "invitationFailed": "فشل في إرسال الدعوة.",
            "blocked": "عضو الفريق ذو البريد الإلكتروني",
            "blockFailed": "فشل في حظر عضو الفريق.",
            "submitting": "جارٍ إرسال ملف البود...",
            "submissionSuccess": "تم إرسال ملف البود بنجاح!",
            "submissionFailed": "فشل في إرسال ملف البود.",
            "correctErrors": "يرجى تصحيح الأخطاء في النموذج."
        }
    },
    zh: {
        "title": {
            "podProfile": "播客简介"
        },
        "headings": {
            "podProfile": "播客简介",
            "socialMedia": "播客社交媒体",
            "team": "团队"
        },
        "labels": {
            "podName": "播客名称",
            "podRss": "播客RSS",
            "podLogo": "播客Logo",
            "hostName": "主持人姓名",
            "googleCalendar": "谷歌日历集成",
            "calendarUrl": "谷歌日历选择日期URL",
            "guestForm": "嘉宾表单URL",
            "facebook": "脸书",
            "instagram": "Instagram",
            "linkedin": "领英",
            "twitter": "推特",
            "tiktok": "抖音",
            "pinterest": "Pinterest",
            "website": "播客网站",
            "email": "播客电子邮件地址",
            "teamName": "姓名",
            "teamEmail": "电子邮件",
            "teamRole": "角色"
        },
        "buttons": {
            "copy": "复制",
            "invite": "邀请",
            "block": "阻止",
            "submit": "提交"
        },
        "options": {
            "selectRole": "选择角色",
            "user": "用户",
            "host": "主持人"
        },
        "errors": {
            "podName": "请输入播客名称。",
            "podRss": "请输入有效的RSS URL。",
            "hostName": "请输入主持人姓名。",
            "calendarUrl": "请输入有效的日历URL。",
            "guestForm": "请输入有效的嘉宾表单URL。",
            "email": "请输入有效的电子邮件地址。",
            "facebook": "请输入有效的脸书URL。",
            "instagram": "请输入有效的Instagram URL。",
            "linkedin": "请输入有效的领英URL。",
            "twitter": "请输入有效的推特URL。",
            "tiktok": "请输入有效的抖音URL。",
            "pinterest": "请输入有效的Pinterest URL。",
            "website": "请输入有效的网站URL。",
            "teamName": "请输入团队成员的姓名。",
            "teamEmail": "请输入有效的电子邮件地址。",
            "teamRole": "请选择一个角色。"
        },
        "notifications": {
            "defaultToast": "这是一个提示消息。",
            "guestFormCopied": "嘉宾表单URL已复制到剪贴板！",
            "copyFailed": "复制URL失败。",
            "calendarActivated": "谷歌日历集成已激活！",
            "calendarDeactivated": "谷歌日历集成已停用！",
            "fillAllFields": "请填写所有团队成员的详细信息。",
            "fillAllTeamFields": "请填写所有团队成员的字段。",
            "invitationSent": "邀请已发送给",
            "invitationFailed": "发送邀请失败。",
            "blocked": "团队成员的电子邮件",
            "blockFailed": "阻止团队成员失败。",
            "submitting": "正在提交播客简介...",
            "submissionSuccess": "播客简介提交成功！",
            "submissionFailed": "提交播客简介失败。",
            "correctErrors": "请纠正表单中的错误。"
        }
    }
};

// Function to load translation file asynchronously
async function loadTranslations(lang) {
    // If translations for the language are already loaded, return them
    if (translations[lang]) {
        return translations[lang];
    }

    // Dynamically fetch translation files
    try {
        const response = await fetch(`locales/${lang}/translation.json`);
        if (!response.ok) {
            throw new Error(`Could not load translations for language: ${lang}`);
        }
        const data = await response.json();
        translations[lang] = data;
        return data;
    } catch (error) {
        console.error(error);
        // Fallback to English if translation fails
        return translations['en'];
    }
}

// Function to initialize i18n with dynamic language
async function initializeI18n(lang = 'en') {
    const currentTranslations = await loadTranslations(lang);
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const keys = element.getAttribute('data-i18n').split('.');
        let text = currentTranslations;
        keys.forEach(key => {
            if (text[key] !== undefined) {
                text = text[key];
            } else {
                // Fallback to English
                text = translations['en'];
                keys.forEach(k => {
                    text = text[k];
                });
            }
        });
        element.textContent = text;
    });

    // Update HTML lang and dir attributes for RTL languages
    const htmlTag = document.documentElement;
    htmlTag.setAttribute('lang', lang);
    if (lang === 'ar') {
        htmlTag.setAttribute('dir', 'rtl');
    } else {
        htmlTag.setAttribute('dir', 'ltr');
    }
}

// Function to get translation
async function getTranslation(key, lang = 'en') {
    const currentTranslations = await loadTranslations(lang);
    const keys = key.split('.');
    let text = currentTranslations;
    for (let k of keys) {
        if (text[k] !== undefined) {
            text = text[k];
        } else {
            // Fallback to English
            text = translations['en'];
            for (let keyPart of keys) {
                text = text[keyPart];
            }
            break;
        }
    }
    return text;
}

// Function to set language and save preference
async function setLanguage(lang) {
    localStorage.setItem('preferredLanguage', lang);
    await initializeI18n(lang);
}

// On page load, set the language based on localStorage or default
document.addEventListener('DOMContentLoaded', async () => {
    const languageSelector = document.getElementById('language-selector');
    if (!languageSelector) {
        console.error("Language selector element with ID 'language-selector' not found.");
        return;
    }

    const savedLang = localStorage.getItem('preferredLanguage') || 'en';
    languageSelector.value = savedLang;
    await initializeI18n(savedLang);

    // Add event listener for language selector change
    languageSelector.addEventListener('change', async (event) => {
        const selectedLang = event.target.value;
        await setLanguage(selectedLang);
    });
});
