{% extends "dashboard/components/base.html" %} {% block title %}Podcast Task
Management{% endblock %} {% block content %}
<!-- Guest Selection Popup -->
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/task.css') }}"
/>
<div id="guest-popup" class="popup">
  <div class="popup-content">
    <header>
      <h1>Select a Guest</h1>
    </header>
    <div class="guest-selection">
      <div
        class="card"
        onclick="selectGuest('GUEST_ID_1', 'Ollina Olsson', 'https://podmanagerstorage.blob.core.windows.net/blob-container/person1.jpg')"
      >
        <img
          src="https://podmanagerstorage.blob.core.windows.net/blob-container/person1.jpg"
          alt="Guest A"
        />
        <p class="episode-count orange" id="ollina-episodes"></p>
        <p class="guest-name">Ollina Olsson</p>
      </div>
      <div
        class="card"
        onclick="selectGuest('GUEST_ID_2', 'Olle Olsson', 'https://podmanagerstorage.blob.core.windows.net/blob-container/person2.jpg')"
      >
        <img
          src="https://podmanagerstorage.blob.core.windows.net/blob-container/person2.jpg"
          alt="Guest B"
        />
        <p class="episode-count red" id="olle-episodes"></p>
        <p class="guest-name">Olle Olsson</p>
      </div>
      <div
        class="card"
        onclick="selectGuest('GUEST_ID_3', 'Olga Olsson', 'https://podmanagerstorage.blob.core.windows.net/blob-container/person3.jpg')"
      >
        <img
          src="https://podmanagerstorage.blob.core.windows.net/blob-container/person3.jpg"
          alt="Guest C"
        />
        <p class="episode-count green" id="olga-episodes"></p>
        <p class="guest-name">Olga Olsson</p>
      </div>
    </div>
  </div>
</div>

<!-- Task Management Section (Initially Hidden) -->
<div
  id="task-management"
  class="responsive-task-management"
  style="display: none"
>
  <!-- Back Arrow -->
  <a
    href="{{ url_for('dashboard_bp.dashboard') }}"
    class="back-arrow"
    id="dashboard-button"
    >&#8592; Dashboard</a
  >

  <!-- Page Header -->
  <div class="task-header" style="text-align: center">
    <img
      id="selected-guest-image"
      src=""
      alt="Selected Guest"
      style="
        display: none;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin-bottom: 10px;
      "
    />
    <h2>Guest : <span id="selected-guest"></span></h2>
    <div class="task-header-buttons" style="justify-content: center">
      <div class="button-group">
        <button id="load-default-btn" onclick="openDefaultTasksPopup()">
          Add Default Tasks
        </button>
        <button id="add-task-btn">+ Add Custom Task</button>
      </div>

      <!-- Wrapper för att flytta Select Episode till höger -->
      <div class="dropdown-wrapper">
        <div class="dropdown view-episode-dropdown">
          <button class="dropbtn" onclick="viewEpisodes()">
            View Episodes
          </button>
          <div class="dropdown-content" id="episode-dropdown">
            <!-- Episodes will be dynamically populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="task-list-container">
    <!-- Current Tasks Header -->
    <h3 class="current-tasks-header">Pod Tasks</h3>

    <!-- Ordered Task List -->
    <ol id="task-list" class="sortable responsive-task-list">
      <!-- Dynamically injected tasks will appear here -->
    </ol>

    <!-- Add Tasks to Episode and Back Button Container -->
    <div class="add-tasks-button-container">
      <div class="dropdown add-tasks-dropdown">
        <button class="dropbtn">Add Tasks To Episode</button>
        <div class="dropdown-content" id="add-tasks-episode-dropdown">
          <!-- Episodes will be dynamically populated here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Task Modal -->
  <div id="task-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <h2 id="modal-title">Create New Task</h2>

      <label for="task-name">Task Name:</label>
      <input type="text" id="task-name" placeholder="Enter task name" />

      <label for="task-dependencies">Dependent on Other Task(s):</label>
      <select id="task-dependencies" multiple>
        <!-- Options dynamically populated -->
      </select>

      <label for="task-type">Task Type & Action:</label>
      <select id="task-type">
        <option value="manual">Manual</option>
        <option value="email">Automated - Email</option>
        <option value="system">Automated - System Action</option>
        <option value="ai">Automated - AI Script</option>
      </select>

      <div id="action-details" class="hidden">
        <label for="action-details-input">Action Details:</label>
        <input
          type="text"
          id="action-details-input"
          placeholder="Enter details"
        />
      </div>

      <label for="due-time">Due Time Since Recording Date:</label>
      <input type="text" id="due-time" placeholder="Enter days" />

      <label for="task-description">Task Description:</label>
      <textarea
        id="task-description"
        placeholder="Enter task details"
      ></textarea>

      <label for="action-link">Action Link:</label>
      <input type="text" id="action-link" placeholder="Enter external link" />
      <input
        type="text"
        id="action-link-desc"
        placeholder="Describe the link"
      />

      <label>
        <input type="checkbox" id="submission-required" /> Require Information
        Submission
      </label>

      <div class="modal-buttons">
        <button id="save-task-btn">Save Task</button>
        <button class="cancel-btn" onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Default Tasks Popup -->
  <div id="default-tasks-popup" class="popup" style="display: none">
    <div class="popup-content">
      <h2>Select Default Tasks</h2>
      <button id="select-all-default-btn" onclick="selectAllDefaultTasks()">
        Select All
      </button>
      <div id="default-tasks-list">
        <!-- Default tasks will be dynamically populated -->
      </div>
      <div class="modal-buttons">
        <button id="add-default-tasks-btn" onclick="addSelectedDefaultTasks()">
          Add Selected Tasks
        </button>
        <button class="cancel-btn" onclick="closeDefaultTasksPopup()">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Episodes Popup -->
  <div id="episodes-popup" class="popup" style="display: none">
    <div class="popup-content">
      <h2>Select Episode</h2>
      <div id="episodes-list">
        <!-- Episodes will be dynamically populated here -->
      </div>
      <div class="modal-buttons">
        <button class="cancel-btn" onclick="closeEpisodesPopup()">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Add this script tag to load SortableJS library -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

  <script src="{{ url_for('static', filename='requests/taskmanagementRequest.js') }}"></script>
  {% endblock %}
</div>
