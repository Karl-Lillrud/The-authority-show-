{% extends "components/base.html" %} 
{% block title %}Team Leaderboard Dashboard{% endblock %} 

{% block head_extra %}
  <!-- Link to the main account CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/account/account.css') }}">
  <!-- Link to the subscription CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/account/subscription.css') }}">
  <!-- Remove any incorrect link to notification.css from here -->
  <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/account/notification.css') }}"> --> 
{% endblock %}

{% block content %}
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PTPQQ5WSQV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-PTPQQ5WSQV');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Account Settings</title> 
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
</head>
<body>
  <div class="account-container">
    <div class="account-header">
      <a href="/dashboard" class="back-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
          <path d="m15 18-6-6 6-6"></path>
        </svg>
        Back to Dashboard
      </a>
    </div>

    <div class="account-settings-wrapper">
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav>
          <ul>
            <li class="sidebar-item active" data-target="profile-section" tabindex="0">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              Profile
            </li>
            <li class="sidebar-item" data-target="settings-purchases" tabindex="0">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
                <rect x="2" y="5" width="20" height="14" rx="2"></rect>
                <line x1="2" y1="10" x2="22" y2="10"></line>
                <circle cx="7" cy="15" r="2"></circle>
                <circle cx="16" cy="15" r="2"></circle>
              </svg>
              Purchases
            </li>
            <li class="sidebar-item" data-toggle="submenu" tabindex="0">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              Settings
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron">
                <path d="m9 18 6-6-6-6"></path>
              </svg>
            </li>
            <ul class="submenu">
              <li class="submenu-item" data-target="profile-section" tabindex="0">Edit Profile</li>
              <li class="submenu-item" data-target="settings-delete" tabindex="0">Delete Account</li>
              <li class="submenu-item" data-target="subscription-change" tabindex="0">Payment Method</li>
            </ul>
            <button id="back-to-main-menu" class="back-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
                <path d="m15 18-6-6 6-6"></path>
              </svg>
              Back to Main Menu
            </button>
          </ul>
        </nav>
      </aside>

      <!-- Main Content Area -->
      <section class="main-content">
        <div class="settings-sections-container">
          <!-- Profile Section -->
          <div id="profile-section" class="settings-section active">
            <div class="profile-content">
              <div class="profile-pic-container">
                <div class="profile-pic-wrapper">
                  <img id="profile-pic" src="{{ profile_pic_url or url_for('static', filename='images/profilepic.png') }}" alt="Profile Picture">
                  <div class="profile-pic-overlay">
                    <i class="fas fa-camera"></i>
                    <span>Change Photo</span>
                  </div>
                  <!-- Ensure this hidden file input exists -->
                  <input type="file" id="profile-pic-input" accept="image/*" style="display: none;"> 
                </div>
                <button id="upload-pic" class="btn btn-secondary upload-btn">
                  <i class="fas fa-upload"></i> Change Photo
                </button>
              </div>
            </div>
            
            <!-- Notification Container -->
            <div id="profile-notifications" class="notifications-container"></div>
            
            <!-- Profile Information Card -->
            <div class="profile-info-card">
              <div class="profile-info-item">
                <div class="info-label">Full Name</div>
                <div class="info-value" id="display-full-name">Loading...</div>
              </div>
              
              <div class="profile-info-item">
                <div class="info-label">Email Address</div>
                <div class="info-value" id="display-email">Loading...</div>
              </div>
              
              <div class="profile-info-item">
                <div class="info-label">Phone Number</div>
                <div class="info-value" id="display-phone">Not provided</div>
              </div>
            </div>
            
            <!-- Edit Profile Button -->
            <div class="profile-actions">
              <button type="button" class="primary-button" id="edit-profile-btn">Edit Profile</button>
            </div>
            
            <!-- Hidden form for editing mode -->
            <form id="profile-form" class="profile-form" style="display: none;">
              <div class="form-group">
                <label for="full-name">Full Name <span class="required required-profile">*</span></label>
                <input type="text" id="full-name" name="full_name" required>
                <div class="form-hint">This name will be displayed on your profile</div>
              </div>
              
              <div class="form-group">
                <label for="email">Email Address <span class="required required-profile">*</span></label>
                <input type="email" id="email" name="email" required>
              </div>
              
              <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone" pattern="^\+?\d{6,15}$">
                <div class="form-hint">Used for account recovery and important notifications</div>
              </div>

              <button type="submit" class="primary-button save-profile-btn">Save Changes</button>
            </form>

            <!-- Newsletter Subscription Form -->
            <div class="subscription-form-container">
              <h3>Subscribe to our newsletter</h3>
              <form class="subscription-form">
                <div class="form-group">
                  <label for="subscription-email">Email Address</label>
                  <input type="email" id="subscription-email" name="email" placeholder="your.email@example.com">
                </div>
                <div class="form-actions">
                  <button type="submit" class="primary-button">Subscribe</button>
                </div>
              </form>
            </div>
          </div>
          
          <!-- Settings - Delete Account Section -->
          <div id="settings-delete" class="settings-section">
            <div class="section-header">
              <h2>Delete Account</h2>
              <p>Permanently delete your account and all associated data</p>
            </div>
            
            <div class="delete-content">
              <div class="warning-card">
                <div class="warning-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                    <path d="M12 9v4"></path>
                    <path d="M12 17h.01"></path>
                  </svg>
                </div>
                <div class="warning-content">
                  <h3>Warning: This action cannot be undone</h3>
                  <p>Deleting your account will permanently remove all your data, including profile information, settings, and subscription details. This action cannot be reversed.</p>
                </div>
              </div>
              
              <form class="delete-form">
                <div class="form-group">
                  <label for="delete-confirm">Type "DELETE" to confirm <span class="required">*</span></label>
                  <input type="text" id="delete-confirm" name="delete_confirm" placeholder="DELETE" required>
                </div>

                <div class="form-group">
                  <label for="delete-email">Confirm your email <span class="required">*</span></label>
                  <input type="email" id="delete-email" name="delete_email" placeholder="Enter your email" required>
                  <div class="form-hint">Enter your email address to confirm deletion</div>
                </div>
                <!-- The form-actions buttons are now handled in the popup -->
              </form>
              <!-- Add this button to trigger the popup manually -->
              <div style="margin-top: 1rem;">
                <button type="button" id="trigger-delete-popup-btn" class="danger-button">
                  Delete Account
                </button>
              </div>
              <!-- Popup container for delete confirmation -->
              <div id="delete-account-popup-container"></div>
            </div>
          </div>

          <!-- Settings - Purchases Section -->
          <div id="settings-purchases" class="settings-section">
            <div class="purchases-content">
              <div class="info-card">
                <div class="info-card-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 10V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v3"></path>
                    <path d="M20 14v3a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-3"></path>
                    <path d="M12 12h.01"></path>
                  </svg>
                </div>
                <div class="info-card-content">
                  <h3>Available Credits: <span id="available-credits">0</span></h3>
                  <p>Your available credits for podcast transcription and other premium features</p>
                </div>
              </div>
              
              <div class="billing-history">
                <h3>Billing History</h3>
                <div class="billing-table">
                  <div class="billing-header">
                    <div class="billing-cell">Date</div>
                    <div class="billing-cell">Description</div>
                    <div class="billing-cell">Amount</div>
                    <div class="billing-cell">Status</div>
                    <div class="billing-cell">Details</div>
                  </div>
                  <div id="billing-history-rows">
                    <!-- Purchases will be loaded here -->
                    <div class="billing-row loading-row">
                      <div class="billing-cell" colspan="4">Loading purchase history...</div>
                    </div>
                  </div>
                </div>
                <div id="no-purchases-message" style="display: none;" class="empty-history-message">
                  No purchase history available.
                </div>
              </div>
            </div>
          </div>

          <!-- Modal for purchase details -->
          <div id="details-modal" class="modal">
            <div class="modal-content">
              <span class="close-modal">&times;</span>
              <div id="details-modal-content"></div>
            </div>
          </div>

          <!-- Payment Method Section -->
          <div id="subscription-change" class="settings-section">
            <div class="section-header">
              <h2>Payment Method</h2>
              <p>Manage your payment methods and billing details</p>
            </div>
            <div class="subscription-content">
              <div class="current-plan-info">
                <div class="info-card">
                  <div class="info-card-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect width="20" height="14" x="2" y="5" rx="2"></rect>
                      <line x1="2" x2="22" y1="10" y2="10"></line>
                    </svg>
                  </div>
                  <div class="info-card-content">
                    <h3>Current Plan: <span id="current-plan">Free</span></h3>
                    <p>Status: <span id="subscription-status">Inactive</span></p>
                    <p id="renewal-text">Expiry date: <strong><span id="subscription-expiry">N/A</span></strong></p>
                  </div>
                </div>
              </div>
              <div class="subscription-actions">
                <button id="cancel-subscription-btn" class="secondary-button">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 6 6 18"></path>
                    <path d="m6 6 12 12"></path>
                  </svg>
                  Cancel Subscription
                </button>
              </div>
              <div class="payment-methods">
                <h3>Payment Methods</h3>
                <div class="payment-card">
                  <div class="payment-card-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect width="20" height="14" x="2" y="5" rx="2"></rect>
                      <line x1="2" x2="22" y1="10" y2="10"></line>
                    </svg>
                  </div>
                  <div class="payment-card-details">
                    <div class="card-name"></div>
                    <div class="card-expiry"></div>
                    <div class="card-type"></div>
                  </div>
                  <div class="payment-card-actions">
                    <button class="text-button">Edit</button>
                    <button class="text-button">Remove</button>
                  </div>
                </div>
                <button class="secondary-button add-payment-button">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14"></path>
                    <path d="M12 5v14"></path>
                  </svg>
                  Add Payment Method
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
  <script src="https://js.stripe.com/v3/"></script>
  <script type="module" src="{{ url_for('static', filename='js/account/subscription.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='js/account/account.js') }}"></script>
{% endblock %}